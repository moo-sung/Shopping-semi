<%@page import="dto.MemberDTO"%>
<%@page import="dao.MemberDAO"%>
<%@page import="util.Utility"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%
if (request.getMethod().equals("GET")) {//비정상적인 요청
	out.println("<script type='text/javascript'>");
	out.println("location.href='" + request.getContextPath() + "/site/index.jsp?workgroup=error&work=error400'");
	out.println("</script>");
	return;
}
//전달값 반환 저장
String email = request.getParameter("email");
String password = Utility.encrypt(request.getParameter("password"));

MemberDTO member = MemberDAO.getDAO().selectMember(email);
if (member == null) {//아이디에 대한 인증 실패가 발생한 경우
	session.setAttribute("email", email);
	out.println("<script type='text/javascript'>");
	out.println("location.href='" + request.getContextPath() + "/site/index.jsp?workgroup=member&work=member_login';");
	out.println("</script>");
	return;
}

if (!member.getPassword().equals(password)) {//비밀번호 실패가 발생한 경우
	session.setAttribute("message", "입력한 아이디가 없거나 비밀번호가 맞지 않습니다.");
	session.setAttribute("email", email);
	out.println("<script type='text/javascript'>");
	out.println("location.href='" + request.getContextPath() + "/site/index.jsp?workgroup=member&work=member_login';");
	out.println("</script>");
	return;
}

//인증 성공
session.setAttribute("loginMember", MemberDAO.getDAO().selectMember(email));

//페이지 이동
String url = (String) session.getAttribute("url");
if (url == null) {//메인페이지 이동
	out.println("<script type='text/javascript'>");
	out.println("location.href='" + request.getContextPath() + "/site/index.jsp?workgroup=product&work=product_list';");
	out.println("</script>");
} else {//요청페이지 이동
	session.removeAttribute("url");
	out.println("<script type='text/javascript'>");
	out.println("location.href='" + url + "';");
	out.println("</script>");
}
%>
