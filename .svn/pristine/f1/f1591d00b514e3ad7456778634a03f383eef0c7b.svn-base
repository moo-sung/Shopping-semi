<%@page import="dto.PostDTO"%>
<%@page import="java.util.List"%>
<%@page import="dao.PostDAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%
//Post테이블에서 글 종류가 notice인 행 모두 호출
List<PostDTO> postList = PostDAO.getDAO().selectAllPostList("NOTICE", "IDX");

//페이징 처리 시작

//초기 페이지 또는 원래 있던 페이지 설정
int postNum = 1;
if (request.getParameter("pageNum") != null) {//전달값이 있는 경우
	postNum = Integer.parseInt(request.getParameter("pageNum"));
}

//하나의 페이지에 검색되어 출력될 게시글의 갯수 설정
int postSize = 10;

//전체 페이지의 갯수를 계산하여 저장
//int totalPage=totalBoard/pageSize+(totalBoard%pageSize==0?0:1);
int totalPost = postList.size();

//JSP 문서를 요청할 때 전달된 페이지 번호에 대한 검증
if (postNum <= 0 || postNum > totalPost) {//전달된 페이지 번호가 비정상적인 경우
	postNum = 1;
}

//요청 페이지 번호에 대한 게시글 시작 행번호를 계산하여 저장
//ex) 1Page : 1, 2Page : 11, 3Page : 21, 4Page : 31,...
int startRow = (postNum - 1) * postSize + 1;
//요청 페이지 번호에 대한 게시글 종료 행번호를 계산하여 저장
//ex) 1Page : 10, 2Page : 20, 3Page : 30, 4Page : 40,...
int endRow = postNum * postSize;

//마지막 페이지에 대한 게시글 종료 행번호를 전체 게시글의 갯수로 변경
if (endRow > totalPost) {
	endRow = totalPost;
}
%>


<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="<%=request.getContextPath()%>/css/index.css">
<link rel="icon" href="<%=request.getContextPath()%>/images/favicon.ico">
<style type="text/css">
table {
	margin: 5px auto;
	border: 0.5px solid white;
	border-collapse: collapse
}

th {
	height: 30px;
	border: 0.5px solid white;
	text-align: center;
}

td {
	height: 30px;
	border: 0.5px solid white;
}

.num {
	width: 5em;
	text-align: center;
}

#body .subject {
	width: 60em;
	text-align: left;
	padding-left: 1em;
}

.writer {
	width: 10em;
	text-align: center;
}

.hit {
	width: 10em;
	text-align: center;
}

#content {
	height: 40em;
}

#searchForm {
	margin: 5px auto;
}
</style>
</head>
<body>
	<div id="wrap">
		<%-- header 불러오기 @@--%>
		<jsp:include page="/form/header.jsp" />
		<!-- container start -->
		<div id="container">
			<%-- side 불러오기 --%>
			<jsp:include page="/form/side.jsp" />
			<!-- content area => 본문작성 -->
			<div id="content">
				<div class="main">

					<table>
						<tr id="header">
							<th class="num">번호</th>
							<th class="subject">제목</th>
							<th class="writer">작성자</th>
							<th class="hit">조회수</th>
						</tr>
						<%-- List에 저장된 PostDTO 인스턴스 이용해 값 전달 --%>
						<% for (PostDTO post : postList) { %>
						<tr id="body">
							<td class="num"><%=post.getIdx()%></td>
							<td class="subject"><%=post.getTitle()%></td>
							<td class="writer">[관]<%=post.getEmail().split("@")[0]%>
							</td>
							<td class="hit"><%=post.getHit()%></td>
						</tr>
						<% } %>
						<%-- 예시 --%>
						<tr id="body">
							<td class="num">2</td>
							<td class="subject">결재관련 오류 안내(현재 상태 : 점검 완료)</td>
							<td class="writer">관리자</td>
							<td class="hit">48221</td>
						</tr>

					</table>

					<div id="searchForm">
						<%-- 페이지 번호 출력 및 링크 설정 - 페이징 처리 --%>
						<%
						//페이지 블럭에 출력될 페이지의 갯수 저장
						int blockSize = 5;

						//페이지 블럭에 출력될 시작 페이지 번호를 계산하여 저장
						//ex) 1Block : 1, 2Block : 6, 3Block : 11, 4Block :	 16,...
						int startPage = (postNum - 1) / blockSize * blockSize + 1;

						//페이지 블럭에 출력될 종료 페이지 번호를 계산하여 저장
						//ex) 1Block : 5, 2Block : 10, 3Block : 15, 4Block : 20,...
						int endPage = startPage + blockSize - 1;

						//마지막 페이지 블럭의 종료 페이지 번호 변경
						if (endPage > totalPost) {
							endPage = totalPost;
						}
						%>

						<% if (startPage > blockSize) {//2번째 블럭 이상인 경우 - 링크 설정 %>
						<a
							href="<%=request.getContextPath()%>/semiproject/wontack/notice.jsp?workgroup=board&work=board_list&pageNum=1">[처음]</a>
						<a
							href="<%=request.getContextPath()%>/site/index.jsp?workgroup=board&work=board_list&pageNum=<%=startPage - blockSize%>">[이전]</a>
						<% } else { %>
						[처음][이전]
						<% } %>

						<% for (int i = startPage; i <= endPage; i++) { %>
							<% if (postNum != i) { %>
								<a href="<%=request.getContextPath()%>/site/index.jsp?workgroup=board&work=board_list&pageNum=<%=i%>">[<%=i%>]</a>
							<% } else { %>
							[<%=i%>]
							<% } %>
						<% } %>

						<% if (endPage != totalPost) {//마지막 페이지 블럭이 아닌 경우 - 링크 설정 %>
						<a href="<%=request.getContextPath()%>/site/index.jsp?workgroup=board&work=board_list&pageNum=<%=startPage + blockSize%>">[다음]</a>
						<a href="<%=request.getContextPath()%>/site/index.jsp?workgroup=board&work=board_list&pageNum=<%=totalPost%>">[마지막]</a>
						<% } else { %>
						[다음][마지막]
						<% } %>
						<div>&nbsp;</div>

					</div>
					<!-- container end -->

					<%-- footer 불러오기 --%>
					<jsp:include page="/form/footer.jsp" />
				</div>
			</div>
		</div>
	</div>


</body>
</html>