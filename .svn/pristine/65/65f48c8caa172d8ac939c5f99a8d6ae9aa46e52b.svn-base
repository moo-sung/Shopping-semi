<%@page import="java.text.DecimalFormat"%>
<%@page import="java.util.ArrayList"%>
<%@page import="dao.ProductDAO"%>
<%@page import="dto.ProductDTO"%>
<%@page import="java.util.List"%>
<%@page import="dto.CartDTO"%>
<%@page import="dao.CartDAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%-- <%@include file="/security/login_url.jspf" %> --%>
<%
//세션 로그인한 유저의 이메일 받아서 파라메타에 저장해주기 -> 변경해야함 
List<CartDTO> cartList = CartDAO.getDAO().selectAllCartList("moo_sung@naver.com");
List<ProductDTO> productList = new ArrayList<ProductDTO>();
for (CartDTO cart : cartList) {
	String productIdx = cart.getProduct_idx();
	ProductDTO product = ProductDAO.getDAO().selectProduct(productIdx);
	productList.add(product);
}

//cartDTO 형태의 cartList
//ProductDTO 형태의 productList
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cart</title>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link
	href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
	rel="stylesheet">
<link rel="stylesheet"
	href="<%=request.getContextPath()%>/css/common.css">
<link rel="icon" href="<%=request.getContextPath()%>/images/favicon.ico">
<style type="text/css">
/* CSS 작성 */
.titleArea h1 {
	margin: 0 0 30px;
	text-align: center;
}

.basketinfo .menu {
	text-align: center;
	border-bottom: 0.3px solid rgb(207, 207, 207);
	max-width: 180px;
	margin: 0 auto;
}

.basketinfo .menu p {
	font-size: 18px;
	margin: 20px 20px 12px;
	padding: 13px 10px 0px;
}

.order-empty p {
	margin: 100px 0;
	text-align: center;
}

.removeBtn {
	text-align: center
}

.removeBtn .textAndBtn {
	margin-right: 620px;
}

.removeBtn #removeSelectBtn {
	background-color: rgb(207, 207, 207);
	cursor: pointer;
	color: rgb(13, 13, 13);
	padding: 6px 12px;
}

.removeBtn #removeAllBtn {
	text-align: right;
	background-color: rgb(207, 207, 207);
	cursor: pointer;
	color: rgb(13, 13, 13);
	padding: 6px 12px;
}

.removeBtn #removeSelectBtn:hover {
	background-color: rgb(13, 13, 13);
	border: 1px solid rgb(207, 207, 207);
	color: rgb(207, 207, 207);
}

.removeBtn #removeAllBtn:hover {
	background-color: rgb(13, 13, 13);
	border: 1px solid rgb(207, 207, 207);
	color: rgb(207, 207, 207);
}

.basket_btn {
	margin: 0 auto;
	width: 400px;
	height: 50px;
	font-size: 1.2em;
	cursor: pointer;
	padding: 12px 0;
	text-align: center;
	margin-top: 50px;
}

.basket_btn .submitAllBtn {
	font-weight: bold;
	color: rgb(13, 13, 13);
	background-color: rgb(171, 195, 159);
	padding: 11px 27px 11px;
	margin-right: 7px;
	border: none;
}

.basket_btn .submitSelectBtn {
	font-weight: bold;
	color: rgb(13, 13, 13);
	background-color: rgb(172, 194, 244);
	padding: 11px 27px 11px;
	border: none;
}

.basket_btn .submitAllBtn:hover {
	background-color: rgb(13, 13, 13);
	border: 1px solid rgb(207, 207, 207);
	color: rgb(207, 207, 207);
}

.basket_btn .submitSelectBtn:hover {
	background-color: rgb(13, 13, 13);
	border: 1px solid rgb(207, 207, 207);
	color: rgb(207, 207, 207);
}

table {
	margin: 5px auto;
	border: 0.5px solid rgb(207, 207, 207);
	width: 900px;
	border-collapse: collapse;
}

th {
	height: 40px;
	border: 0.5px solid rgb(207, 207, 207);
	text-align: center;
}

td {
	height: 40px;
	border: 0.5px solid rgb(207, 207, 207);
	text-align: center;
}

.price .count {
	display: inline-block;
	position: relative;
	vertical-align: top;
}

.upBtn {
	
}

.downBtn {
	
}

.cartTable table {
	font-size: 13px;
}

.cartTable .quantity button {
	background-color: rgb(13, 13, 13);
	border: 1px solid rgb(207, 207, 207);
	color: rgb(207, 207, 207);
	padding: 4px 8px;
	margin: 8px 5px 8px;
}

.cartTable .quantity button:hover {
	background-color: rgb(207, 207, 207);
	border: 1px solid rgb(13, 13, 13);
	color: rgb(13, 13, 13);
}

#wrap {
	width: 1200px;
}
</style>
</head>
<body>
	<div id="wrap">
		<%-- header 불러오기 --%>
		<jsp:include page="../form/header.jsp" />
		<%-- side 불러오기 --%>
		<jsp:include page="../form/side.jsp" />
		<!-- container start -->
		<div id="container">
			<!-- content area -->
			<div id="content">
				<div class="titleArea">
					<h1>Shopping Cart</h1>
				</div>
				<div class="basketinfo">
					<div class="menu">
						<p>국내배송상품</p>
					</div>
				</div>
				<br>
				<div class="cartlist">
					<form class="cartTable">
						<%
						for (int i = 0; i < productList.size(); i++) {
						%>
						<input type="hidden" id="productIdx<%=i%>"
							value=<%=cartList.get(i).getProduct_idx()%>>
						<%
						}
						%>
						<table>
							<tr>
								<th><input type="checkbox" class="test" id="allCheck"></th>
								<th>CartIdx</th>
								<th>Qty</th>
								<th>Item</th>
								<th>Price</th>
								<th>Total</th>
							</tr>
							
							<%
							for (int i = 0; i < productList.size(); i++) {
							%>
							<tr>
								<td><input type="checkbox" class="test"></td>
								<td id="cartIdx<%=i%>" class="cartIdx"><%=cartList.get(i).getCart_idx()%></td>
								<td id="quantity<%=i%>" class="quantity"><span
									class="ctoun"> <input type="text" id="cnt<%=i%>"
										value="1" readonly="readonly"
										style="width: 20px; border: none;"> <a href="#none"
										id="up"> <img src="../namkyu/image/btn_count_up.gif"
											id="up<%=i%>" class="upBtn" onclick="up()">
									</a> <a href="#none" id="down"> <img
											src="../namkyu/image/btn_count_down.gif" id="down<%=i%>"
											class="downBtn" onclick="down()">
									</a> <br>
										<button id="button<%=i%>">edit</button>
								</span></td>
								<td id="name<%=i%>" class="name"><%=productList.get(i).getName()%></td>
								<td id="price<%=i%>" class="price"><%=DecimalFormat.getCurrencyInstance().format(productList.get(i).getPrice())%></td>
							</tr>
							<%
							}
							%>
						</table>
					</form>
				</div>
				<br>
				<div class="removeBtn">
					<span class="textAndBtn"> <span>선택상품을</span>
						<button type="button" id="removeSelectBtn">삭제하기</button>
					</span> <span>
						<button type="button" id="removeAllBtn">장바구니비우기</button>
					</span>
				</div>
				<br> <br>
				<div class="basket_btn">
					<input type="submit" class="submitAllBtn" value="전체상품 주문">
					<input type="submit" class="submitSelectBtn" value="선택상품 주문">
				</div>

				<script type="text/javascript">					
					var count= 1;
					function up() {
						count++;
						document.getElementById("cnt").setAttribute("value", count);
						return;
					}
					function down() {
						document.getElementById("cnt").setAttribute("value", count);
						count--;
						if(count<0) {
							alert("최소 수량을 확인해주세요.");
							document.getElementById("cnt").setAttribute("value", 1);
							return;
						}
						return;
					}
				
				$(document).ready(function() {
					<%--
					$("#allCheck").click(function(){ 
							//전체 선택 체크박스가 체크된 경우 
							if($("#allCheck").prop("checked")) { 
								$(".test").prop("checked",true); 
							} else { 
								$(".test").prop("checked",false); 
							} 
					});
					--%>
					
				})	
					
				$("#removeSelectBtn").click(function() {
					if(window.confirm("선택하신 제품을 삭제하시겠습니까?")) {
						location.href="<%=request.getContextPath()%>/index.jsp?workgroup=minjeong&work=cart_remove?cartcheck=checkedList"
					}
				});
				
				$("#removeAllBtn").click(function() {
					if(window.confirm("장바구니를 비우시겠습니까?")) {
						location.href="<%=request.getContextPath()%>
					/index.jsp?workgroup=minjeong&work=cart_clear";
										}
									});

					$("#submitAllBtn").click(function() {
						location.href = "";
					});

					$("#submitSelectBtn").click(function() {
						location.href = "";
					});
				</script>
			</div>
			<!-- container end -->
			<%-- footer 불러오기 --%>
			<jsp:include page="../form/footer.jsp" />
		</div>
	</div>
</body>
</html>